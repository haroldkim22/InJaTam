<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¶€ì†Œì‚° íŒŒë…¸ë¼ë§ˆ ì§€ë„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet & Pannellum -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css" />

  <style>
    :root{
      /* ë ˆì´ì•„ì›ƒ ì¡°ì •ìš© ë³€ìˆ˜ (ì›í•˜ë©´ ìˆ˜ì¹˜ë§Œ ë°”ê¿”ë„ ì „ì²´ê°€ ê°™ì´ ì¡°ì •ë¨) */
      --page-max-w: 1200px;    /* ì»¨í…ì¸  ìµœëŒ€ í­ (ì¢Œìš° ì—¬ë°± ìœ ì§€) */
      --side-gap: 32px;        /* ì¢Œìš° ì—¬ë°± */
      --header-h: 120px;       /* ì œëª© ì˜ì—­ ë†’ì´ */
      --between-gap: 24px;     /* ì œëª©ê³¼ ì§€ë„ ì‚¬ì´ ê°„ê²© */
      --map-bottom-gap: 16px;  /* ì§€ë„ í•˜ë‹¨ ì—¬ë°±(ê±°ì˜ 0ì— ê°€ê¹ê²Œ) */
    }

    /* í™”ë©´ ì „ì²´ ê·¸ë¼ë°ì´ì…˜ (í—¤ë”+ì§€ë„+ì—¬ë°± ì „ë¶€ ì ìš©) */
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(135deg, #F0F8B8 0%, #B8E986 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif;
    }

    /* ì¤‘ì•™ ì •ë ¬ëœ í˜ì´ì§€ ë˜í¼ */
    .page {
      min-height: 100%;
      max-width: var(--page-max-w);
      margin: 0 auto;
      padding: 0 var(--side-gap);
      display: flex;
      flex-direction: column;
      /* ì§€ë„ ì˜ì—­ì´ í™”ë©´ ì •ì¤‘ì•™ë³´ë‹¤ ì‚´ì§ ì•„ë˜ë¡œ ë³´ì´ë„ë¡ ìœ„ìª½ ê³µê°„ì„ ë” ë°°ë¶„ */
    }

    /* ìƒë‹¨ ì œëª© ë°•ìŠ¤ (ìŠ¤í¬ë¦°ìƒ·ì²˜ëŸ¼ ì‚´ì§ ë°ì€ ë°•ìŠ¤ + ê·¸ë¦¼ì) */
    #header {
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 12px;
      background: linear-gradient(135deg, #F3FCD2 0%, #C6ECA7 100%);
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      border: 2px solid rgba(0, 0, 0, 0.15);
    }
    #title {
      font-size: 38px;
      font-weight: 800;
      color: #555555;
      text-shadow: 1px 2px 6px rgba(0,0,0,0.25);
    }

    /* ì§€ë„/íŒŒë…¸ë¼ë§ˆ ì»¨í…Œì´ë„ˆ: ì¢Œìš° ì—¬ë°± ìœ ì§€, í•˜ë‹¨ ì—¬ë°± ê±°ì˜ ì—†ê²Œ */
    .map-wrap {
      position: relative;
      /* ë‚¨ì€ ì„¸ë¡œê³µê°„ì„ ê±°ì˜ ì „ë¶€ ì§€ë„ê°€ ì°¨ì§€ â†’ í•˜ë‹¨ ì—¬ë°± ì•ˆ ìƒê¸°ë„ë¡ */
      height: calc(100vh - var(--header-h) - var(--between-gap) - var(--map-bottom-gap));
      margin-top: var(--between-gap);
      margin-bottom: var(--map-bottom-gap);
      border-radius: 12px;
      overflow: hidden;        /* ê°€ì¥ìë¦¬ ë¼ìš´ë“œ */
      box-shadow: 0 10px 24px rgba(0,0,0,0.12);
      background: #eef7ff;     /* ë¡œë”© ì¤‘ ë°°ê²½ */
      border: 2px solid rgba(0, 0, 0, 0.12);
    }

    /* ì‹¤ì œ ì§€ë„/íŒŒë…¸ë¼ë§ˆ DOM */
    #map, #panorama {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }
    #panorama { display: none; }

    /* Leaflet íšŒìƒ‰ ë°°ê²½ ì œê±°(ë°”ê¹¥ ê·¸ë¼ë°ì´ì…˜ì´ ë¹„ì¹˜ê²Œ) */
    .leaflet-container { background: transparent !important; }

    /* íŒŒë…¸ë¼ë§ˆ ì»¨íŠ¸ë¡¤ ì˜¤ë²„ë ˆì´ */
    #controls {
      position: absolute;
      top: 16px;
      left: 16px;
      z-index: 1000;
      display: none;
    }
    #controls button {
      margin-right: 8px;
      padding: 8px 12px;
      border: 0;
      border-radius: 8px;
      background: rgba(255,255,255,0.9);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      font-weight: 600;
      color: #083a57;
      cursor: pointer;
    }
    #controls button:hover { background: #ffffff; }

    /* ë°˜ì‘í˜•: ì‘ì€ í™”ë©´ì—ì„œ ì œëª©/ì—¬ë°± ì‚´ì§ ì¶•ì†Œ */
    @media (max-width: 640px){
      :root{
        --header-h: 96px;
        --side-gap: 16px;
      }
      #title{ font-size: 28px; }
    }
  </style>
</head>

<body>
  <div class="page">
    <!-- ìƒë‹¨ ì œëª© ë°•ìŠ¤ -->
    <header id="header">
      <div id="title">ğŸ—ºï¸ ë¶€ì†Œì‚° íŒŒë…¸ë¼ë§ˆ ì§€ë„</div>
    </header>

    <!-- ì§€ë„ & íŒŒë…¸ë¼ë§ˆ ì˜ì—­ (ì¢Œìš° ì—¬ë°± ìœ ì§€, í•˜ë‹¨ ê½‰ ì±„ì›€) -->
    <div class="map-wrap">
      <div id="map"></div>
      <div id="panorama"></div>

      <div id="controls">
        <button id="soundToggle">ğŸ”Š Sound On</button>
        <button id="exitBtn">âª Back to Map</button>
      </div>
    </div>
  </div>

  <!-- JS libs -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

  <script>
    // === ê¸°ë³¸ ì´ë¯¸ì§€ ì§€ë„ ì„¸íŒ… (PNG í•œ ì¥ì„ ì§€ë„ì²˜ëŸ¼) ===
    const imgWidth = 2754;
    const imgHeight = 1556;
    const bounds = [[0,0], [imgHeight, imgWidth]];

    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1,
      maxZoom: 1,
      maxBounds: bounds,
      maxBoundsViscosity: 1.0   // ê²½ê³„ ë°”ê¹¥ ë“œë˜ê·¸ ëª» ë‚˜ê°€ê²Œ
    });

    const customIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/haroldkim22/InJaTam/refs/heads/haroldkim22-markertry/marker.svg',
      iconSize: [100, 100], 
      iconAnchor: [20, 40], 
      popupAnchor: [0, -40] 
    })

    const imageUrl = 'https://i.imgur.com/O5p8OLJ.png';
    L.imageOverlay(imageUrl, bounds).addTo(map);

    map.fitBounds(bounds);
    const minZoomAtFit = map.getZoom();   // fitBounds í›„ ì‹¤ì œ ì¤Œ ë ˆë²¨
    map.setMinZoom(minZoomAtFit);         // ì´ ì´í•˜ë¡œëŠ” ì¶•ì†Œ ê¸ˆì§€
    map.setMaxBounds(bounds);             // ì§€ë„ ì˜ì—­ ë°–ìœ¼ë¡œ ëª» ë‚˜ê°€ê²Œ


    // ë“œë˜ê·¸ í—ˆìš©
    function updateDragState() {
      const z = map.getZoom();
      
      map.dragging.enable();
      map.keyboard.enable();
      
    }
    map.on('zoomend', updateDragState);
    updateDragState();

    // ë°ëª¨ìš© ëœë¤ ë§ˆì»¤ 20ê°œ
    for (let i=0; i<20; i++) {
      const x = Math.random() * imgWidth;
      const y = Math.random() * imgHeight;
      const marker = L.marker([y,x], {icon: customIcon}).addTo(map);
      marker.bindTooltip("ë§ˆì»¤"+(i+1), {direction:"top"});
      marker.on("click", ()=> showPanorama("ë§ˆì»¤"+(i+1)));
    }

    // === íŒŒë…¸ë¼ë§ˆ ë·°ì–´ & ì‚¬ìš´ë“œ ===
    let viewer;
    const audio = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_b3bcbba7a1.mp3");
    audio.loop = true;

    function showPanorama(name){
      document.getElementById("map").style.display="none";
      document.getElementById("panorama").style.display="block";
      document.getElementById("controls").style.display="block";
      if(viewer) viewer.destroy();
      viewer = pannellum.viewer('panorama', {
        type: "equirectangular",
        panorama: "https://pannellum.org/images/alma.jpg",
        autoLoad: true,
        title: name
      });
    }

    const soundBtn = document.getElementById("soundToggle");
    soundBtn.onclick = ()=>{
      if(audio.paused){ audio.play(); soundBtn.textContent="ğŸ”Š Sound On";}
      else { audio.pause(); soundBtn.textContent="ğŸ”‡ Sound Off";}
    };

    const exitBtn = document.getElementById("exitBtn");
    exitBtn.onclick = ()=>{
      document.getElementById("map").style.display="block";
      document.getElementById("panorama").style.display="none";
      document.getElementById("controls").style.display="none";
      if(viewer) viewer.destroy();
      audio.pause();
      map.fitBounds(bounds);
      updateDragState();
    };
  </script>
</body>
</html>
